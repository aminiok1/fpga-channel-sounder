/******************************************************************************
*
* Copyright (C) 2009 - 2014 Xilinx, Inc.  All rights reserved.
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* Use of the Software is limited solely to applications:
* (a) running on a Xilinx device, or
* (b) that interact with a Xilinx device through a bus or interconnect.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
* XILINX  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF
* OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* Except as contained in this notice, the name of the Xilinx shall not be used
* in advertising or otherwise to promote the sale, use or other dealings in
* this Software without prior written authorization from Xilinx.
*
******************************************************************************/

/*
 * helloworld.c: simple test application
 *
 * This application configures UART 16550 to baud rate 9600.
 * PS7 UART (Zynq) is not initialized by this application, since
 * bootrom/bsp configures it to baud rate 115200
 *
 * ------------------------------------------------
 * | UART TYPE   BAUD RATE                        |
 * ------------------------------------------------
 *   uartns550   9600
 *   uartlite    Configurable only in HW design
 *   ps7_uart    115200 (configured by bootrom/bsp)
 */

#include <stdio.h>
#include <math.h>

#include "platform.h"
#include "xil_printf.h"
#include "xparameters.h"
#include "xaxidma.h"
#include "xuartps.h"
#include "xgpio.h"
#include "fir_dma.h"


#define GPIO_DEVICE_ID_NOISE	XPAR_AXI_GPIO_0_DEVICE_ID
#define GPIO_DEVICE_ID_ACC		XPAR_AXI_GPIO_1_DEVICE_ID

#define FLOAT2FIXED(x, frac_bits) ((int)((x) * (1 << frac_bits)))
#define FIXED2FLOAT(x, frac_bits) (((float)(x)) / (1 << frac_bits))

XGpio NoiseScaleGpio, AccCountGpio;

int *bram_result = (int *) (XPAR_BRAM_1_BASEADDR);
int *bram_sounding_fd = (int *) (XPAR_BRAM_2_BASEADDR);
int *bram_sounding = (int *) (XPAR_BRAM_0_BASEADDR);

float matlab_sounding_input[2048] = {0.028320, -0.012695, 0.024973, -0.013587, 0.015032, -0.016364, 0.003101, -0.019854, -0.005419, -0.022538, -0.006492, -0.023205, 0.000880, -0.021248, 0.014144, -0.016589, 0.028073, -0.009461, 0.036688, -0.000284, 0.035510, 0.010240, 0.023277, 0.020954, 0.002487, 0.030228, -0.021425, 0.036271, -0.041959, 0.037720, -0.053776, 0.034239, -0.054463, 0.026776, -0.045230, 0.017269, -0.030296, 0.007899, -0.015242, 0.000250, -0.004962, -0.005180, -0.001956, -0.008863, -0.005609, -0.011579, -0.012665, -0.013631, -0.018703, -0.014399, -0.019980, -0.012571, -0.014938, -0.006954, -0.004762, 0.002555, 0.007181, 0.014415, 0.016770, 0.025680, 0.020797, 0.033031, 0.018165, 0.034142, 0.010155, 0.028746, -0.000307, 0.018856, -0.009984, 0.008018, -0.016622, -0.000080, -0.019629, -0.003028, -0.019875, -0.000521, -0.018831, 0.005711, -0.017550, 0.012771, -0.016091, 0.017801, -0.013687, 0.019004, -0.009543, 0.016102, -0.003765, 0.010161, 0.002178, 0.002995, 0.005844, -0.003530, 0.004942, -0.008010, -0.001326, -0.009738, -0.011463, -0.008704, -0.021939, -0.005477, -0.028519, -0.001037, -0.028121, 0.003418, -0.020307, 0.006721, -0.007643, 0.008032, 0.005317, 0.007080, 0.014016, 0.004240, 0.015912, 0.000355, 0.011574, -0.003645, 0.004306, -0.007156, -0.001495, -0.010114, -0.002456, -0.012874, 0.002224, -0.015815, 0.010544, -0.018890, 0.018828, -0.021416, 0.023609, -0.022291, 0.023262, -0.020554, 0.018579, -0.016003, 0.012048, -0.009504, 0.006311, -0.002756, 0.002689, 0.002420, 0.000612, 0.004925, -0.001761, 0.004894, -0.006099, 0.003593, -0.012524, 0.002715, -0.019127, 0.003444, -0.022757, 0.005813, -0.020708, 0.008713, -0.012415, 0.010556, -0.000203, 0.010237, 0.011411, 0.007833, 0.017607, 0.004614, 0.015462, 0.002353, 0.005357, 0.002289, -0.009078, 0.004348, -0.022494, 0.007098, -0.030063, 0.008480, -0.029369, 0.006957, -0.021117, 0.002415, -0.008440, -0.003692, 0.004712, -0.009065, 0.015213, -0.011781, 0.021668, -0.011318, 0.024292, -0.008811, 0.024079, -0.006391, 0.021926, -0.005952, 0.018288, -0.008065, 0.013501, -0.011655, 0.008419, -0.014650, 0.004748, -0.015219, 0.004629, -0.012911, 0.009535, -0.008982, 0.019056, -0.005719, 0.030378, -0.005095, 0.038986, -0.007540, 0.040479, -0.011564, 0.032719, -0.014500, 0.017218, -0.014015, -0.001079, -0.009533, -0.015684, -0.002756, -0.021365, 0.003108, -0.016545, 0.005041, -0.004105, 0.001954, 0.009849, -0.004512, 0.018739, -0.010625, 0.018493, -0.012397, 0.009353, -0.007686, -0.004341, 0.002533, -0.016237, 0.014436, -0.020892, 0.023080, -0.016137, 0.024746, -0.003807, 0.018721, 0.011371, 0.007637, 0.024078, -0.003802, 0.030684, -0.011036, 0.030464, -0.011689, 0.025305, -0.006454, 0.018270, 0.001539, 0.011926, 0.008443, 0.007310, 0.011551, 0.003981, 0.010340, 0.000920, 0.006265, -0.002406, 0.001567, -0.005509, -0.002149, -0.007196, -0.004718, -0.006481, -0.007213, -0.003465, -0.010928, 0.000412, -0.016248, 0.002982, -0.022122, 0.002494, -0.026485, -0.001363, -0.027413, -0.007176, -0.024303, -0.012471, -0.018382, -0.014981, -0.012179, -0.013817, -0.008226, -0.009898, -0.007684, -0.005375, -0.009687, -0.002391, -0.011777, -0.001878, -0.011248, -0.003102, -0.006683, -0.004207, 0.001150, -0.003494, 0.009535, -0.000668, 0.015078, 0.002675, 0.015358, 0.003675, 0.010114, -0.000325, 0.001361, -0.010218, -0.007587, -0.024333, -0.013674, -0.038859, -0.015426, -0.049336, -0.013408, -0.052511, -0.009643, -0.047640, -0.006396, -0.036628, -0.004984, -0.022991, -0.005262, -0.010205, -0.005983, -0.000299, -0.005778, 0.006621, -0.004149, 0.011781, -0.001918, 0.016494, -0.000862, 0.021027, -0.002747, 0.024246, -0.008278, 0.024238, -0.016521, 0.019575, -0.025112, 0.010474, -0.031148, -0.000811, -0.032344, -0.010658, -0.027929, -0.015540, -0.018895, -0.013569, -0.007558, -0.005361, 0.003338, 0.006195, 0.011557, 0.017183, 0.015991, 0.024312, 0.016800, 0.026220, 0.015098, 0.023842, 0.012399, 0.019738, 0.010048, 0.016751, 0.008806, 0.016659, 0.008681, 0.019439, 0.009010, 0.023416, 0.008749, 0.026145, 0.006899, 0.025558, 0.002949, 0.020828, -0.002812, 0.012597, -0.009261, 0.002567, -0.014751, -0.007270, -0.017712, -0.015342, -0.017312, -0.020848, -0.013886, -0.023659, -0.008893, -0.023951, -0.004347, -0.021868, -0.001946, -0.017440, -0.002279, -0.010826, -0.004525, -0.002699, -0.006827, 0.005521, -0.007207, 0.011823, -0.004609, 0.014213, 0.000481, 0.011549, 0.006142, 0.004247, 0.009879, -0.005552, 0.009815, -0.014523, 0.005654, -0.019294, -0.001093, -0.017741, -0.007739, -0.009902, -0.011633, 0.001938, -0.011351, 0.014078, -0.007309, 0.022865, -0.001485, 0.026149, 0.003582, 0.024113, 0.006008, 0.019059, 0.005392, 0.014238, 0.002857, 0.012247, 0.000314, 0.013751, -0.000641, 0.017153, 0.000381, 0.019421, 0.002341, 0.017695, 0.003333, 0.010911, 0.001619, 0.000607, -0.003377, -0.009536, -0.010630, -0.015279, -0.017851, -0.013829, -0.022438, -0.005283, -0.022591, 0.007203, -0.018091, 0.018676, -0.010396, 0.024532, -0.002061, 0.022543, 0.004254, 0.013835, 0.006724, 0.002323, 0.004901, -0.007096, -0.000326, -0.010755, -0.007241, -0.007773, -0.014010, -0.000267, -0.019290, 0.007823, -0.022523, 0.012664, -0.023873, 0.012257, -0.023917, 0.007151, -0.023258, -0.000091, -0.022249, -0.006303, -0.020899, -0.009212, -0.018982, -0.008276, -0.016265, -0.004537, -0.012743, 0.000261, -0.008790, 0.004697, -0.005130, 0.008212, -0.002635, 0.010900, -0.002009, 0.012817, -0.003457, 0.013344, -0.006506, 0.011146, -0.010054, 0.004883, -0.012695, -0.005690, -0.013205, -0.018903, -0.011017, -0.031241, -0.006486, -0.038462, -0.000786, -0.037354, 0.004514, -0.027292, 0.008060, -0.010788, 0.009233, 0.007311, 0.008355, 0.021685, 0.006493, 0.028608, 0.004939, 0.027275, 0.004605, 0.019806, 0.005612, 0.009999, 0.007246, 0.001520, 0.008282, -0.003572, 0.007527, -0.005275, 0.004309, -0.004996, -0.001282, -0.004282, -0.008468, -0.003725, -0.016104, -0.002649, -0.023040, 0.000275, -0.028375, 0.005917, -0.031508, 0.013779, -0.032060, 0.021853, -0.029791, 0.027391, -0.024623, 0.028181, -0.016802, 0.023636, -0.007085, 0.015128, 0.003178, 0.005366, 0.012231, -0.002808, 0.018342, -0.007592, 0.020360, -0.008756, 0.018162, -0.007347, 0.012789, -0.004809, 0.006151, -0.002095, 0.000415, 0.000715, -0.002725, 0.004126, -0.002595, 0.008506, 0.000297, 0.013459, 0.004543, 0.017740, 0.008423, 0.019831, 0.010572, 0.018852, 0.010429, 0.015253, 0.008335, 0.010809, 0.005245, 0.007837, 0.002211, 0.007983, -0.000109, 0.011238, -0.001711, 0.015743, -0.003153, 0.018555, -0.005160, 0.017032, -0.008131, 0.010164, -0.011790, -0.000829, -0.015175, -0.012922, -0.017006, -0.022537, -0.016273, -0.026998, -0.012780, -0.025497, -0.007349, -0.019183, -0.001560, -0.010403, 0.002908, -0.001578, 0.005035, 0.005701, 0.004938, 0.010956, 0.003810, 0.014472, 0.003297, 0.016636, 0.004588, 0.017431, 0.007678, 0.016395, 0.011207, 0.013028, 0.013037, 0.007355, 0.011325, 0.000246, 0.005578, -0.006738, -0.002868, -0.011927, -0.011268, -0.014228, -0.016647, -0.013553, -0.017201, -0.010752, -0.013203, -0.007127, -0.006920, -0.003802, -0.001509, -0.001312, 0.000570, 0.000404, -0.001159, 0.001661, -0.004931, 0.002613, -0.007688, 0.003050, -0.006797, 0.002535, -0.001655, 0.000788, 0.005709, -0.001969, 0.011431, -0.004962, 0.011699, -0.007190, 0.004785, -0.007935, -0.007831, -0.007158, -0.021889, -0.005504, -0.032217, -0.003886, -0.035123, -0.002889, -0.030140, -0.002357, -0.020193, -0.001469, -0.010106, 0.000712, -0.004178, 0.004493, -0.004090, 0.009097, -0.008215, 0.012824, -0.012699, 0.013839, -0.013702, 0.011225, -0.009615, 0.005701, -0.002018, -0.000450, 0.005138, -0.004322, 0.007709, -0.003810, 0.003717, 0.001200, -0.005406, 0.008523, -0.015405, 0.014493, -0.021331, 0.015622, -0.020098, 0.010313, -0.012072, -0.000172, -0.000824, -0.012021, 0.008843, -0.020375, 0.013515, -0.021374, 0.012994, -0.013838, 0.010286, 0.000162, 0.009710, 0.016082, 0.014154, 0.028689, 0.023017, 0.034046, 0.032063, 0.030890, 0.035430, 0.020872, 0.028815, 0.007660, 0.012193, -0.004604, -0.009472, -0.012837, -0.028048, -0.015914, -0.035834, -0.014693, -0.029217, -0.011292, -0.010562, -0.008021, 0.012655, -0.006450, 0.031115, -0.006947, 0.037773, -0.008789, 0.030886, -0.010705, 0.014520, -0.011569, -0.003606, -0.010956, -0.015816, -0.009347, -0.017898, -0.007910, -0.010643, -0.007965, 0.001072, -0.010313, 0.011018, -0.014735, 0.014670, -0.019876, 0.011057, -0.023629, 0.002634, -0.023947, -0.006555, -0.019779, -0.013240, -0.011731, -0.016530, -0.002111, -0.017937, 0.005787, -0.019957, 0.008940, -0.024149, 0.005914, -0.029854, -0.002356, -0.034320, -0.012734, -0.034171, -0.021023, -0.027388, -0.023648, -0.014699, -0.019160, 0.000410, -0.008877, 0.013108, 0.003670, 0.019348, 0.014253, 0.017648, 0.019765, 0.009656, 0.019477, -0.000738, 0.015169, -0.009232, 0.010070, -0.012978, 0.007131, -0.011598, 0.007497, -0.006972, 0.009934, -0.002048, 0.011501, 0.000664, 0.009154, 0.000144, 0.001482, -0.002925, -0.010306, -0.006752, -0.022636, -0.009394, -0.031015, -0.009562, -0.031979, -0.006938, -0.024647, -0.002017, -0.011155, 0.004282, 0.004227, 0.010946, 0.016867, 0.016985, 0.023629, 0.021425, 0.023968, 0.023337, 0.019842, 0.022073, 0.014537, 0.017631, 0.011042, 0.010933, 0.010733, 0.003743, 0.012968, -0.001888, 0.015691, -0.004482, 0.016681, -0.003900, 0.014789, -0.001587, 0.010533, -0.000085, 0.005798, -0.001922, 0.002804, -0.008389, 0.002889, -0.018738, 0.005724, -0.030249, 0.009367, -0.039168, 0.011156, -0.042154, 0.009028, -0.037616, 0.002652, -0.026393, -0.006190, -0.011505, -0.014182, 0.002896, -0.017812, 0.012917, -0.014898, 0.016150, -0.005638, 0.012310, 0.007289, 0.003160, 0.019645, -0.008163, 0.027214, -0.018123, 0.027381, -0.023782, 0.020071, -0.023552, 0.007654, -0.017580, -0.006078, -0.007696, -0.017419, 0.003083, -0.024056, 0.011408, -0.025655, 0.014630, -0.023545, 0.011725, -0.019755, 0.003762, -0.015930, -0.006313, -0.012691, -0.014608, -0.009711, -0.017656, -0.006371, -0.013714, -0.002575, -0.003476, 0.000823, 0.010135, 0.002262, 0.023046, 0.000319, 0.031541, -0.005318, 0.033587, -0.013309, 0.029431, -0.020949, 0.021268, -0.025226, 0.012195, -0.024200, 0.004963, -0.018021, 0.001083, -0.009031, 0.000604, -0.000852, 0.002531, 0.003152, 0.005535, 0.001340, 0.008547, -0.005513, 0.010951, -0.014588, 0.012409, -0.022282, 0.012571, -0.025708, 0.010989, -0.023776, 0.007355, -0.017376, 0.001966, -0.008721, -0.003956, -0.000247, -0.008385, 0.006327, -0.009185, 0.010382, -0.005101, 0.012162, 0.003399, 0.012215, 0.013961, 0.010933, 0.023034, 0.008468, 0.027225, 0.004997, 0.024717, 0.001058, 0.016119, -0.002371, 0.004295, -0.004219, -0.006764, -0.003901, -0.013552, -0.001773, -0.014414, 0.000900, -0.010078, 0.002554, -0.003149, 0.002214, 0.003140, 0.000150, 0.006318, -0.002126, 0.005585, -0.002632, 0.001897, -0.000059, -0.002699, 0.005329, -0.006086, 0.011614, -0.006921, 0.016082, -0.004985, 0.016602, -0.000977, 0.012779, 0.004012, 0.006196, 0.008988, -0.000445, 0.013293, -0.004839, 0.016552, -0.006403, 0.018502, -0.006590, 0.018913, -0.007952, 0.017712, -0.012416, 0.015218, -0.019760, 0.012284, -0.027267, 0.010144, -0.030886, 0.009929, -0.027434, 0.012061, -0.016644, 0.015842, -0.001874, 0.019525, 0.011088, 0.020948, 0.016679, 0.018481, 0.012370, 0.011863, 0.000142, 0.002509, -0.014257, -0.006931, -0.024014, -0.013597, -0.024612, -0.015603, -0.016106, -0.012840, -0.003098, -0.007025, 0.007644, -0.000977, 0.010740, 0.002571, 0.005066, 0.002091, -0.005578, -0.002173, -0.014408, -0.008406, -0.015237, -0.014064, -0.005827, -0.016958, 0.010743, -0.016102, 0.027451, -0.011990, 0.036756, -0.006230, 0.034344, -0.000767, 0.021248, 0.002949, 0.003297, 0.004466, -0.011800, 0.004355, -0.018206, 0.003755, -0.014613, 0.003716, -0.004514, 0.004628, 0.005942, 0.006001, 0.011271, 0.006680, 0.009377, 0.005409, 0.002288, 0.001496, -0.005352, -0.004717, -0.009073, -0.011812, -0.007077, -0.017728, -0.001075, -0.020552, 0.004894, -0.019361, 0.006923, -0.014725, 0.003541, -0.008635, -0.003429, -0.003770, -0.009888, -0.002363, -0.011742, -0.005122, -0.007151, -0.010719, 0.002491, -0.016166, 0.013329, -0.018034, 0.021081, -0.014069, 0.023177, -0.004475, 0.019852, 0.007772, 0.013678, 0.017881, 0.007918, 0.021191, 0.004705, 0.015309, 0.004070, 0.001477, 0.004282, -0.015561, 0.003185, -0.029282, -0.000365, -0.034072, -0.005814, -0.027716, -0.011359, -0.012552, -0.015160, 0.005315, -0.016502, 0.018508, -0.016157, 0.021518, -0.015708, 0.013106, -0.016294, -0.003152, -0.017609, -0.020457, -0.017865, -0.031827, -0.014829, -0.033204, -0.007352, -0.025193, 0.003541, -0.012639, 0.014735, -0.002230, 0.022372, 0.000724, 0.023760, -0.005186, 0.018816, -0.016839, 0.010173, -0.028138, 0.001864, -0.033005, -0.002741, -0.028366, -0.002616, -0.015706, 0.000556, -0.000452, 0.003495, 0.010515, 0.003291, 0.012038, -0.000939, 0.003069, -0.007616, -0.012849, -0.013715, -0.029169, -0.016586, -0.039221, -0.015467, -0.039055, -0.011776, -0.028967, -0.008006, -0.013128, -0.005948, 0.002389, -0.005358, 0.012198, -0.004007, 0.013622, 0.000835, 0.007362, 0.010314, -0.003285, 0.022625, -0.014095, 0.033349, -0.021602, 0.037534, -0.024092, 0.032492, -0.021651, 0.019721, -0.015527, 0.004717, -0.007330, -0.005484, 0.001475, -0.005915, 0.009667, 0.003470, 0.016117, 0.017290, 0.019761, 0.027079, 0.019862, 0.025414, 0.016482, 0.009795, 0.010818, -0.015754, 0.005030, -0.042288, 0.001466, -0.060014, 0.001563, -0.062840, 0.004999, -0.051114, 0.009630, -0.031196, 0.012408, -0.012141, 0.010914, -0.001229, 0.004778, -0.000661, -0.003805, -0.007043, -0.010850, -0.013808, -0.012369, -0.015142, -0.006358, -0.009263, 0.006027, 0.000706, 0.020754, 0.008662, 0.032604, 0.009126, 0.037493, 0.000493, 0.034304, -0.013832, 0.025342, -0.027038, 0.015164, -0.032342, 0.008388, -0.026419, 0.007570, -0.011008, 0.012185, 0.008069, 0.019182, 0.023865, 0.024751, 0.031586, 0.026337, 0.030479, 0.023817, 0.023462, 0.019280, 0.014899, 0.015569, 0.007946, 0.014465, 0.003014, 0.015545, -0.001836, 0.016392, -0.008928, 0.014052, -0.018744, 0.006940, -0.028889, -0.003883, -0.034979, -0.014825, -0.033052, -0.021303, -0.022117, -0.019970, -0.005329, -0.010474, 0.011029, 0.004149, 0.020366, 0.018707, 0.019007, 0.028104, 0.008097, 0.029519, -0.006833, 0.023460, -0.018501, 0.013236, -0.021374, 0.003192, -0.014289, -0.003350, -0.000888, -0.005411, 0.012290, -0.004348, 0.019039, -0.002651, 0.016380, -0.002290, 0.005730, -0.003545, -0.008102, -0.004926, -0.019434, -0.004165, -0.024345, 0.000321, -0.022146, 0.008314, -0.015098, 0.017643, -0.006775, 0.025043, -0.000141, 0.027569, 0.003618, 0.023839, 0.004990, 0.014520, 0.005082, 0.001933, 0.004449, -0.010928, 0.002647, -0.021408, -0.001213, -0.027791, -0.007314, -0.029347, -0.014236, -0.026078, -0.019072, -0.018473, -0.018680, -0.007528, -0.011509, 0.005055, 0.001047, 0.016810, 0.014650, 0.024881, 0.023601, 0.026904, 0.023353, 0.022075, 0.012756, 0.011830, -0.005115, -0.000342, -0.024069, -0.010079, -0.037388, -0.013876, -0.040704, -0.010610, -0.033842, -0.002074, -0.020748, 0.007813, -0.007602, 0.014800, -0.000028, 0.016273, -0.000706, 0.012440, -0.008467, 0.006151, -0.019163, 0.001420, -0.027779, 0.001392, -0.030733, 0.006749, -0.027286, 0.015347, -0.019528, 0.023234, -0.011091, 0.026537, -0.005336, 0.023289, -0.003885, 0.014329, -0.006127, 0.002902, -0.009798, -0.006792, -0.012215, -0.011361, -0.011531, -0.009512, -0.007464, -0.002359, -0.001243, 0.007244, 0.005047, 0.015897, 0.009370, 0.020823, 0.010478, 0.020565, 0.008237, 0.015110, 0.003517, 0.005620, -0.002205, -0.005980, -0.007329, -0.017392, -0.010547, -0.026284, -0.011103, -0.030710, -0.008903, -0.029595, -0.004502, -0.023191, 0.001034, -0.013211, 0.006360, -0.002445, 0.010164, 0.006148, 0.011495, 0.010554, 0.010024, 0.010515, 0.006149, 0.007594, 0.000897, 0.004390, -0.004351, 0.003235, -0.008239, 0.005019, -0.009814, 0.008753, -0.008781, 0.012144, -0.005580, 0.012870, -0.001252, 0.009915, 0.002874, 0.004196, 0.005605, -0.001852, 0.006274, -0.005553, 0.004974, -0.005427, 0.002528, -0.002005, 0.000146, 0.002451, -0.001098, 0.005166, -0.000791, 0.004341, 0.000567, 0.000090, 0.001748, -0.005716, 0.001390, -0.010580, -0.001232, -0.012865, -0.005645, -0.012734, -0.010170, -0.012012, -0.012571, -0.013022, -0.011137, -0.017053, -0.005691, -0.023387, 0.002007, -0.029474, 0.008789, -0.032227, 0.011398, -0.029739, 0.008044, -0.022448, -0.000553, -0.013049, -0.011209, -0.005145, -0.019499, -0.001342, -0.021672, -0.001851, -0.016377, -0.004381, -0.005365, -0.005453, 0.007222, -0.002409, 0.016686, 0.004964, 0.019884, 0.014142, 0.016620, 0.021095, 0.009639, 0.022427, 0.003232, 0.017246, 0.001148, 0.007763, 0.004816, -0.001758, 0.012756, -0.007132, 0.021409, -0.006346, 0.026942, -0.000491, 0.027090, 0.006953, 0.022126, 0.012059, 0.014513, 0.012539, 0.007508, 0.008847, 0.003484, 0.003715, 0.002870, 0.000440, 0.004212, 0.000906, 0.005250, 0.004488, 0.004364, 0.008443, 0.001534, 0.009536, -0.001700, 0.005977, -0.003255, -0.001474, -0.001898, -0.009863, 0.001804, -0.015662, 0.005541, -0.016731, 0.006371, -0.013490, 0.002313, -0.008631, -0.006417, -0.005514, -0.017201, -0.006191, -0.026023, -0.010181, -0.029212, -0.014742, -0.025090, -0.016500, -0.014739, -0.013524, -0.001519, -0.006634, 0.010386, 0.000848, 0.017701, 0.004834, 0.019247, 0.002762, 0.016086, -0.004837, 0.010663, -0.014406, 0.005442, -0.021105, 0.001767, -0.021317, -0.000548, -0.014580, -0.002749, -0.003876, -0.006140, 0.005902, -0.011114, 0.010493, -0.016709, 0.008465, -0.020921, 0.001867, -0.021591, -0.005004, -0.017421, -0.008034, -0.008671, -0.005596, 0.002782, 0.000555, 0.014013, 0.006305, 0.022007, 0.007560, 0.024631, 0.002679, 0.021296, -0.006395, 0.013128, -0.014988, 0.002609, -0.018108, -0.007159, -0.013184, -0.013362, -0.001635, -0.014322, 0.011588, -0.010015, 0.020314, -0.002110, 0.020183, 0.006550, 0.010826, 0.012901, -0.003891, 0.014764, -0.017721, 0.011691, -0.025037, 0.005201, -0.023495, -0.001760, -0.015033, -0.005984, -0.004747, -0.005337, 0.001757, 0.000293, 0.001183, 0.008880, -0.005855, 0.017068, -0.015246, 0.021572, -0.021540, 0.020558, -0.020795, 0.014377, -0.012673, 0.005328, -0.000787, -0.003436, 0.008893, -0.009315, 0.010824, -0.011319, 0.002570, -0.010269, -0.013840, -0.008099, -0.032509, -0.006669, -0.045973, -0.006717, -0.048224, -0.007528, -0.037211, -0.007474, -0.015760, -0.005119, 0.009404, -0.000256, 0.030171, 0.005715, 0.040061, 0.010351, 0.036589, 0.011399, 0.022085, 0.008081, 0.002682, 0.001728, -0.014102, -0.004653, -0.022232, -0.007714, -0.019377, -0.005410, -0.007627, 0.001891, 0.007524, 0.011399, 0.019502, 0.019079, 0.023308, 0.021480, 0.017435, 0.017361, 0.004278, 0.008306, -0.011082, -0.001981, -0.023134, -0.009407, -0.028235, -0.011435, -0.025935, -0.008291, -0.018814, -0.002869, -0.010982, 0.000664, -0.006036, -0.001094, -0.005462, -0.009072, -0.008228, -0.021163, -0.011673, -0.033097, -0.013158, -0.040360, -0.011566, -0.040259, -0.007852, -0.033168, -0.004381, -0.022364, -0.003451, -0.012514, -0.005825, -0.007531, -0.010103, -0.008789, -0.013308, -0.014538, -0.012378, -0.020792, -0.005794, -0.023257, 0.005533, -0.019398, 0.018575, -0.009655, 0.029552, 0.002763, 0.035614, 0.013386, 0.035983, 0.018597, 0.032009, 0.017307, 0.026173, 0.011420, 0.020669, 0.004850, 0.016361, 0.001580, 0.012672, 0.003706, 0.008413, 0.010413, 0.002978, 0.018383, -0.002843, 0.023444, -0.007002, 0.022649, -0.007230, 0.015789, -0.002444, 0.005577, 0.006322, -0.003571, 0.016049, -0.007579, 0.022943, -0.004602, 0.024181, 0.004162, 0.019290, 0.015081, 0.010447, 0.023825, 0.001519, 0.027335, -0.003695, 0.025094, -0.003152, 0.019099, 0.002597, 0.012623, 0.010811, 0.008453, 0.017902, 0.007532, 0.021041, 0.008692, 0.019259, 0.009562, 0.013586, 0.008127, 0.006326, 0.004038, -0.000092, -0.001062, -0.004064, -0.004417, -0.005202, -0.003771, -0.004129, 0.001152, -0.001954, 0.008170, 0.000236, 0.013499, 0.001645, 0.013601, 0.001851, 0.007099, 0.000832, -0.004250, -0.000925, -0.016111, -0.002311, -0.023481, -0.001681, -0.023082, 0.002658, -0.015082, 0.011598, -0.003248, 0.024359, 0.006614, 0.038127, 0.009262, 0.048613, 0.002468, 0.051534, -0.011837, 0.044478, -0.028271, 0.028297, -0.040266, 0.007246, -0.042873, -0.012407, -0.034840, -0.024810, -0.019083, -0.026944, -0.001371, -0.019903, 0.012103, -0.008365, 0.017182, 0.001538, 0.013174, 0.004980, 0.002735, 0.000529, -0.009591, -0.009426, -0.019416, -0.020059, -0.024189, -0.026586, -0.023854, -0.026561, -0.020352, -0.020899, -0.016381, -0.013153, -0.014070, -0.007510, -0.014182, -0.006590, -0.016101, -0.010169, -0.018436, -0.015425, -0.019844, -0.018498, -0.019622, -0.016492, -0.017849, -0.008881, -0.015124, 0.002319, -0.012131, 0.013610, -0.009336, 0.021619, -0.006918, 0.024425, -0.004918, 0.021987, -0.003429, 0.015646, -0.002654, 0.007139, -0.002803, -0.002197, -0.003913, -0.011635, -0.005745, -0.020683, -0.007868, -0.028556, -0.009895, -0.033979, -0.011718, -0.035569, -0.013553, -0.032595, -0.015704, -0.025624, -0.018162, -0.016534, -0.020265, -0.007784, -0.020703, -0.001253, -0.017976, 0.002684, -0.011179, 0.005266, -0.000750, 0.008495, 0.011242, 0.013755, 0.021532, 0.020681, 0.026759, 0.027001, 0.024824, 0.029547, 0.015913, 0.025987, 0.002682, 0.016356, -0.010567, 0.003492, -0.019445, -0.007965, -0.021137, -0.013619, -0.015466, -0.011407, -0.004895, -0.002652, 0.006533, 0.008498, 0.014857, 0.017016, 0.017723, 0.019386, 0.015120, 0.015241, 0.009051, 0.007444, 0.002341, 0.000578, -0.002803, -0.001370, -0.005779, 0.003023, -0.007657, 0.011958, -0.010329, 0.021340, -0.015190, 0.026769, -0.022051, 0.025579, -0.028866, 0.017945, -0.032472, 0.006588, -0.030047, -0.004652, -0.020607, -0.012594, -0.005809, -0.015973, 0.010371, -0.015647, 0.023041, -0.013803};
float matlab_sounding_freq_input[2048] = {-1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, -0.000000, 0.000000, 0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 0.000000, 0.000000, -0.000000, -0.000000, -0.000000, -0.000000, 0.000000, -0.000000, -0.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, 1.000000, 1.000000, 1.000000, -1.000000, 1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000, -1.000000, -1.000000, 1.000000, 1.000000, -1.000000, -1.000000, -1.000000, -1.000000, -1.000000, 1.000000, -1.000000};


XAxiDma AxiDmaReloadReal, AxiDmaConfigReal, AxiDmaReloadImag, AxiDmaConfigImag;

XUartPs Uart_Ps;

int initDma() {

	int status;

	XAxiDma_Config  *CfgPtrConfigReal, *CfgPtrReloadReal, *CfgPtrConfigImag, *CfgPtrReloadImag;

	// Initialize Config DMA
	CfgPtrConfigReal = XAxiDma_LookupConfig((XPAR_AXI_DMA_1_DEVICE_ID));
	if (!CfgPtrConfigReal) {
		print("Error: Failed to find DMA Config\n");
		return XST_FAILURE;
	}
	status = XAxiDma_CfgInitialize(&AxiDmaConfigReal, CfgPtrConfigReal);
	if (status != XST_SUCCESS) {
		print("Error: Failed to Initialize DMA\n");
		return XST_FAILURE;
	}

	//check for scatter gather mode
	if (XAxiDma_HasSg(&AxiDmaConfigReal)) {
		print("Error: DMA has Scatter Gather Enabled \n");
		return XST_FAILURE;
	}

	// Initialize Reload DMA
	CfgPtrReloadReal = XAxiDma_LookupConfig((XPAR_AXI_DMA_DEVICE_ID));
	if (!CfgPtrReloadReal) {
		print("Error: Failed to find DMA Config\n");
		return XST_FAILURE;
	}
	status = XAxiDma_CfgInitialize(&AxiDmaReloadReal, CfgPtrReloadReal);
	if (status != XST_SUCCESS) {
		print("Error: Failed to Initialize DMA\n");
		return XST_FAILURE;
	}

	//check for scatter gather mode
	if (XAxiDma_HasSg(&AxiDmaReloadReal)) {
		print("Error: DMA has Scatter Gather Enabled \n");
		return XST_FAILURE;
	}

	//Imaginary filter DMAs
	// Initialize Config DMA
	CfgPtrConfigImag = XAxiDma_LookupConfig((XPAR_AXI_DMA_3_DEVICE_ID));
	if (!CfgPtrConfigImag) {
		print("Error: Failed to find DMA Config\n");
		return XST_FAILURE;
	}
	status = XAxiDma_CfgInitialize(&AxiDmaConfigImag, CfgPtrConfigImag);
	if (status != XST_SUCCESS) {
		print("Error: Failed to Initialize DMA\n");
		return XST_FAILURE;
	}

	//check for scatter gather mode
	if (XAxiDma_HasSg(&AxiDmaConfigImag)) {
		print("Error: DMA has Scatter Gather Enabled \n");
		return XST_FAILURE;
	}

	// Initialize Reload DMA
	CfgPtrReloadImag = XAxiDma_LookupConfig((XPAR_AXI_DMA_2_DEVICE_ID));
	if (!CfgPtrReloadImag) {
		print("Error: Failed to find DMA Config\n");
		return XST_FAILURE;
	}
	status = XAxiDma_CfgInitialize(&AxiDmaReloadImag, CfgPtrReloadImag);
	if (status != XST_SUCCESS) {
		print("Error: Failed to Initialize DMA\n");
		return XST_FAILURE;
	}

	//check for scatter gather mode
	if (XAxiDma_HasSg(&AxiDmaReloadImag)) {
		print("Error: DMA has Scatter Gather Enabled \n");
		return XST_FAILURE;
	}


	return XST_SUCCESS;
}

int initGpio() {

	int status;

	status = XGpio_Initialize(&NoiseScaleGpio, GPIO_DEVICE_ID_NOISE);
	if (status != XST_SUCCESS)
		return XST_FAILURE;

	XGpio_SetDataDirection(&NoiseScaleGpio, 1, 0x00000000);

	status = XGpio_Initialize(&AccCountGpio, GPIO_DEVICE_ID_ACC);
		if (status != XST_SUCCESS)
			return XST_FAILURE;

		XGpio_SetDataDirection(&AccCountGpio, 1, 0x00000000);

	return XST_SUCCESS;
}

int setNoiseScale(float scale)
{
	int scale_fixed = FLOAT2FIXED(scale, SCALE_F);

	XGpio_DiscreteWrite(&NoiseScaleGpio, 1, scale_fixed);

	return XST_SUCCESS;
}

int setAccCount(int acc)
{
	XGpio_DiscreteWrite(&AccCountGpio, 1, acc);

	return XST_SUCCESS;
}

void setFilterTaps(char filter_real[FILTER_SIZE], char filter_imag[FILTER_SIZE])
{
	// Real part filter
	int filter_real_taps_idx[3] = {0, 0, 10};
	float filter_real_taps_amp[3] = {0, 1, 1};

	// Imaginary part filter
	int filter_imag_taps_idx[3] = {0, 0, 0};
	float filter_imag_taps_amp[3] = {0, 0, 0};

	int i;

	for (i = 0; i < FILTER_SIZE; i++){
		filter_real[i] = 0x00;
		filter_imag[i] = 0x00;
	}

	for (i = 0; i < 3; i++){
		filter_real[FILTER_SIZE - 1 - filter_real_taps_idx[i]] = FLOAT2FIXED(filter_real_taps_amp[i], FILTER_F);
		filter_imag[FILTER_SIZE - 1 - filter_imag_taps_idx[i]] = FLOAT2FIXED(filter_imag_taps_amp[i], FILTER_F);
	}


}


int main()
{
	char filter_real[FILTER_SIZE], filter_imag[FILTER_SIZE];
	int i;

    init_platform();
    initDma();
    initGpio();

    // set scaling factor for the noise generator module and number of accumulations for integration
    setNoiseScale(10);
    setAccCount(1024);

    // set filter delay and amplitude, and load the values to FIR IP
    //setFilterTaps(filter_real, filter_imag);
    //reloadFilter(filter_real, filter_imag);

    // Load sounding waveform in time domain into the BRAM
    //for (i = 0; i < 2048; i++)
    //	bram_sounding[i] = FLOAT2FIXED(matlab_sounding_input[i], DATA_IN_F);

   // for (i = 0; i < 2048; i++)
    //   	bram_sounding_fd[i] = FLOAT2FIXED(matlab_sounding_freq_input[i], FIR_F);

    // Read the FFT results from BRAM, compare with MATLAB's results
    for (i = 0; i < 2048; i++){
    	//int bram = bram_result[i];
    	float hw_res = FIXED2FLOAT(bram_result[i], DATA_OUT_F);
    	//if (hw_res > 1 || hw_res < -1)
    	//	printf("%f <<<>>> %x\n", hw_res, bram);
    	printf("%f\r\n", FIXED2FLOAT(bram_result[i], DATA_OUT_F));
    }
    cleanup_platform();

    return 0;
}
